​		1)Producer
​			(1)ack:0 1 -1(all)
​			(2)幂等性(同分区同会话)
​			(3)事务(跨会话-事务ID由客户端指定)
​			(4)分区分配规则:指定offset,指定key,轮询(粘性)
​		2)Broker
​			(1)分区：提高并行度(读写),提高负载(集群存储)
​			(2)副本：提高可靠性
​				ISR,OSR,AR  -->  老版本:时间和条数   新版本:时间
​				LEO,HW
​		3)Consumer
​			(1)分区分配策略:
​				range:主题
​				round:全部
​			(2)精准一次性消费:
​				下游幂等性框架:延迟提交偏移量offset,重复
​				下游有事务:
​					Spark:手动提交offset+保存数据到一个事务
​					Flink:两阶段提交

### Kafka集群规模



​		4)整体
​			(1)数据量
​				100万日活  100条数据  100万*100 = 1亿
​				1亿/(24*3600) = 1150条/s   1K
​				高峰:20倍 2万条/s           20m/s
​			(2)台数
​				经验公式 (峰值速度*副本数/100)*2+1 = 3台
​			(3)副本数
​				默认1个,2-3 2居多
​			(4)分区数
​				生产数据高峰 20m/s tp
​				消费数据高峰 40m/s tc
​				期望数据高峰 100m/s t
​				分区数=t/min(tp,tc)=5
​		
​			(6)预留磁盘空间
​				(100G*2*3)/0.7 = 1T
​			(7)监控
​				KafkaEagel KafkaManager
​			(8)压测
​				生产速度 消费速度